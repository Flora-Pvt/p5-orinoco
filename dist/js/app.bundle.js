!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const r="http://localhost:3000/api/teddies";class a{async getProducts(){try{const e=await fetch(r);return await e.json()}catch(e){alert(e)}}async getProduct(e){try{const t=await fetch(`${r}/${e}`);return await t.json()}catch(e){alert(e)}}async postData(e){const t=document.getElementsByTagName("input"),n=document.getElementById("order-btn"),r=document.getElementById("form");n.addEventListener("click",()=>{if(r.addEventListener("submit",(function(e){e.preventDefault()})),r.checkValidity()){const n=[];e.forEach(e=>{n.push(e._id)});const r={contact:{firstName:t[1].value,lastName:t[2].value,address:t[3].value,city:t[5].value,email:t[0].value},products:n},a=new Request("http://localhost:3000/api/teddies/order",{method:"POST",body:JSON.stringify(r),headers:new Headers({"Content-Type":"application/json"})});fetch(a).then((function(e){return e.json()})).then((function(e){const t=e.orderId;localStorage.setItem("orderId",t),window.location.href="commande.html"})).catch((function(e){alert(e)}))}})}}class i{constructor(){this.template=document.getElementById("template")}displayCartNumber(e){let t=0;null!=e&&e.forEach(e=>{t+=e.number}),document.querySelector(".cart-items").innerHTML=t}displayProductsBase(e,t){const n=t.getElementById("img"),r=t.getElementById("name"),a=t.getElementById("price");n.setAttribute("src",e.imageUrl),n.setAttribute("alt","ours en peluche "+e.name),r.innerHTML=e.name,a.innerHTML+=e.price/100+" €"}displayProducts(e){e.forEach(e=>{const t=this.template.content.cloneNode(!0);this.displayProductsBase(e,t);const n=t.getElementById("id"),r=t.getElementById("link");n.setAttribute("href","pages/produit.html?id="+e._id),r.setAttribute("href","pages/produit.html?id="+e._id),this.template.parentNode.appendChild(t)})}displayProduct(e){const t=this.template.content.cloneNode(!0);this.displayProductsBase(e,t);const n=t.getElementById("description"),r=t.getElementById("colors"),a=e.colors,i=document.getElementById("add");n.innerHTML=e.description,a.forEach(e=>{const t=document.createElement("option");t.setAttribute("for","colors"),t.innerHTML=e,r.appendChild(t)}),i.dataset.id=e._id,this.template.parentNode.appendChild(t)}displayCart(e){if(null==e||0===e.length){document.getElementById("no-product").innerHTML="Vous n'avez pas d'ourson dans le panier.";document.getElementById("order-btn").disabled=!0}else e.forEach(e=>{const t=this.template.content.cloneNode(!0),n=e;this.displayProductsBase(n,t);const r=t.getElementById("product-total"),a=t.getElementById("reference"),i=t.getElementById("quantity"),o=t.getElementById("remove"),d=t.getElementById("add");t.getElementById("clear").dataset.id=n._id,d.dataset.id=n._id,o.dataset.id=n._id,a.innerHTML+=n._id,i.innerHTML=n.number,r.innerHTML+=n.number*n.price/100+" €",this.template.parentNode.appendChild(t)})}displayProductTotal(e){event.target.parentElement.previousElementSibling.children[1].innerHTML=e[0].number*e[0].price/100+" €"}displayTotal(e){const t=document.querySelector(".cart-total");let n=0;e&&e.forEach(e=>{n+=parseInt(e.number*e.price)}),t.innerHTML=n/100,localStorage.setItem("total",n)}displayOrder(e){if(e){const t=this.template.content.cloneNode(!0),n=localStorage.getItem("total");t.getElementById("order"),t.getElementById("total").innerHTML+=n/100,t.getElementById("orderId").innerHTML+=e,this.template.parentNode.appendChild(t),localStorage.clear()}}}class o{constructor(){this.dom=new i}changeQuantity(e){const t=document.getElementById("cart"),n=event.target.dataset.id,r=e.filter(e=>e._id===n);if(event.target.classList.contains("remove")&&r[0].number>1){r[0].number--;event.target.nextElementSibling.innerHTML=r[0].number}else if(event.target.classList.contains("add")){r[0].number++;event.target.previousElementSibling.innerHTML=r[0].number}const a=e.filter(e=>e._id!==n);a.push(r[0]),localStorage.setItem("cart",JSON.stringify(a)),this.dom.displayCartNumber(e),t&&(this.dom.displayTotal(e),this.dom.displayProductTotal(r))}addProduct(e,t,n){const r=document.getElementById("add"),a=document.getElementById("feedback");r.addEventListener("click",()=>{if(e&&!0===colors.validity.valid){if(e.some(e=>e._id===n)){(new o).changeQuantity(e),a.innerHTML="Quantité dans le panier : "}else t.number=1,e.push(t),localStorage.setItem("cart",JSON.stringify(e)),quantity.innerHTML=t.number,a.innerHTML="Quantité dans le panier : ",this.dom.displayCartNumber(e)}else!1===colors.validity.valid?a.innerHTML="Veuillez choisir une couleur.":(e=[],t.number=1,e.push(t),localStorage.setItem("cart",JSON.stringify(e)),quantity.innerHTML=t.number,a.innerHTML="Quantité dans le panier : ",this.dom.displayCartNumber(e))})}cartOperations(e){document.querySelector(".cart-content").addEventListener("click",t=>{if(t.target.classList.contains("clear")){const n=t.target.dataset.id,r=e.filter(e=>e._id!==n);localStorage.setItem("cart",JSON.stringify(r)),location.reload()}else(t.target.classList.contains("add")||t.target.classList.contains("remove"))&&this.changeQuantity(e)})}formSubmit(){const e=document.getElementById("form");e.addEventListener("submit",(function(t){!1===e.checkValidity()&&(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated")}),!1)}}window.onload=function(){const e=window.location.search,t=new URLSearchParams(e).get("id"),n=JSON.parse(localStorage.getItem("cart")),r=document.getElementById("index"),d=document.getElementById("cart"),l=localStorage.getItem("orderId"),s=new a,c=new i,u=new o;switch(!0){case null!==r:s.getProducts().then(e=>{c.displayProducts(e),c.displayCartNumber(n)});break;case null!==t:s.getProduct(t).then(e=>{c.displayProduct(e),c.displayCartNumber(n),u.addProduct(n,e,t)});break;case null!==d:c.displayCart(n),c.displayTotal(n),c.displayCartNumber(n),u.cartOperations(n),u.formSubmit(),s.postData(n);break;default:c.displayOrder(l)}}}]);